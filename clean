#!/bin/bash
# Clean temporary files generated by some tasks

FUNC="-ext -show"
EXT="java tex"
TEX=".aux .bbl .bcf .blg .lof .log .lot .out .run.xml .toc"
JAVA=".class"

RM="rm -f -v"
ECHO="echo"

function OBJManipulation(){
    for FILE in $(find . -type f -iname "*"$2 2>/dev/null)
    do
        for OBJ in $3
        do
            OBJ="${FILE/$2/$OBJ}"
            [ -f "$OBJ" ] && $1 "$OBJ" &
        done
    done
    wait
}

if [ "$#" -lt 2 ] ; then
    echo "Usage: clean [-func] [-predicate]"
    exit
elif [[ $FUNC != *"$1"* ]] ; then
    printf "List of available functions:\n$FUNC\n"
    exit
else
    case $1 in
    -ext)
        if [[ $EXT != *"$2"* ]] ; then
            printf "List of available predicates:\n$EXT\n"
            exit
        fi
    ;;
    -show)
        if [[ $EXT != *"$2"* ]] ; then
            printf "List of available predicates:\n$EXT\n"
            exit
        fi
    esac
    if [ "$#" -gt 3 ] ; then
        if [ "$3" == "-add" ] ; then
            case $2 in
            tex)
                for STR in "${@: 4}"
                do
                    TEX="$TEX"" "".$STR"
                done
            ;;
            java)
                for STR in "${@: 4}"
                do
                    JAVA="$JAVA"" "".$STR"
                done
            esac
        fi
    fi
fi

case $1 in
-ext)
    echo "Your working directory" is \'$(pwd)\'
    echo "This action will remove all "$2" aux files from this directory onwards."
    printf "Are you sure you want to continue? (Y/N) "
    read CHECK
    until [ \( $CHECK == 'Y' \) -o \( $CHECK == 'y' \) -o \( $CHECK == 'N' \) -o \( $CHECK == 'n' \) ]
    do
        printf "Invalid option. (Y/N) "
        read CHECK
    done
    if [ \( $CHECK == 'N' \) -o \( $CHECK == 'n' \) ] ; then
        echo "No changes made."
        exit
    fi
    case $2 in
    tex) OBJManipulation "$RM" "."$2 "$TEX"
    ;;
    java) OBJManipulation "$RM" "."$2 "$JAVA"
    esac
;;
-show)
    echo "Your working directory" is \'$(pwd)\'
    case $2 in
    tex) OBJManipulation "$ECHO" "."$2 "$TEX"
    ;;
    java) OBJManipulation "$ECHO" "."$2 "$JAVA"
    esac
esac
